<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Pointing Reconstruction Model · Stripeline.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Stripeline.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><a class="tocitem" href="../basic/">Basic functions</a></li><li><a class="tocitem" href="../instrumentdb/">Instrument database</a></li><li><a class="tocitem" href="../tod/">Time-ordered data</a></li><li><a class="tocitem" href="../scanning/">Scanning strategy</a></li><li><a class="tocitem" href="../noise/">Noise generation</a></li><li class="is-active"><a class="tocitem" href>Pointing Reconstruction Model</a><ul class="internal"><li><a class="tocitem" href="#Geometry-of-the-telescope"><span>Geometry of the telescope</span></a></li><li><a class="tocitem" href="#Configuration-angles"><span>Configuration angles</span></a></li><li><a class="tocitem" href="#Pointing-Reconstruction-Method"><span>Pointing Reconstruction Method</span></a></li><li><a class="tocitem" href="#Example"><span>Example</span></a></li><li><a class="tocitem" href="#Reference-Documentation"><span>Reference Documentation</span></a></li></ul></li><li><a class="tocitem" href="../acquisition/">Data acquisition</a></li><li><a class="tocitem" href="../mapmaking/">Map making</a></li><li><a class="tocitem" href="../simulation_tutorial/">Full-scale simulation tutorial</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Pointing Reconstruction Model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Pointing Reconstruction Model</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/lspestrip/Stripeline.jl/blob/master/docs/src/prm.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="prm"><a class="docs-heading-anchor" href="#prm">Pointing Reconstruction Model (PRM)</a><a id="prm-1"></a><a class="docs-heading-anchor-permalink" href="#prm" title="Permalink"></a></h1><p>Starting from the scanning strategy described in <a href="../scanning/#scanning_strategy">Scanning strategy</a> we can improve the model taking into account the non idealities of the system, parametrized by the so-called <em>configuration angles</em>.</p><p>The aim of the PRM is to calculate the pointing direction of a generic camera mounted on the STRIP telescope, given the control angles (encoding the positions of the azimuth and altitudes motors) as a function of time and the configuration angles describing the geometry of the telescope.</p><h2 id="Geometry-of-the-telescope"><a class="docs-heading-anchor" href="#Geometry-of-the-telescope">Geometry of the telescope</a><a id="Geometry-of-the-telescope-1"></a><a class="docs-heading-anchor-permalink" href="#Geometry-of-the-telescope" title="Permalink"></a></h2><p>First, to understand all the control angles lets analyze a model of the telescope and its  alt-az mount. A simplified model is reported in the following figure.</p><figure>
    <img src="assets/prm/telescope_model.png" width="60%"/>
    <figcaption>Fig.1 Telescope model</figcaption>
</figure><p>A basement holds a vertical axis (V-AXIS) allowing the Azimuth rotation, a fork mounted on the top of the V-AXIS holds the horizontal axis (H-AXIS) which allows the Altitude rotation. In an ideal case V-AXIS and H-AXIS are perpendicular and V-AXIS is aligned with the local (topocentric) zenith.</p><p>The rotation around the V-AXIS is performed by the <em>ground</em> motor, while the rotation around H-AXIS by the <em>altitude</em> motor. There is also a <em>boresight</em> motor that will be kept constant and equal to zero. The position of each motor is encoded by three angles (<em>wheel1ang</em>, <em>wheel2ang</em>, <em>wheel3ang</em>) that describe, respectively, the boresight, the altitude and the ground motor rotation.</p><h2 id="Configuration-angles"><a class="docs-heading-anchor" href="#Configuration-angles">Configuration angles</a><a id="Configuration-angles-1"></a><a class="docs-heading-anchor-permalink" href="#Configuration-angles" title="Permalink"></a></h2><p>To describe the non idealities of the telescope we need nine angles, each of which represent a rotation around specific (<span>$\hat{e}_x$</span>, <span>$\hat{e}_y$</span>, <span>$\hat{e}_z$</span>) coordinate axis:</p><ol><li><p><code>wheel1ang_0</code>, <code>wheel2ang_0</code>, <code>wheel3ang_0</code>: </p><p>encode the deviation of the zero point of the telescope&#39;s motors:</p><ul><li><em>wheel1</em> correspond to the boresight motor, and the zero point angle cause a rotation around the z-axis;</li><li><em>wheel2</em> correspond to the altitude motor, and the zero point angle cause a rotation around the y-axis;</li><li><em>wheel3</em> correspond to the ground motor, and the zero point angle cause a rotation around the z-axis.</li></ul></li><li><p><code>forkang</code>: </p><p>encodes the deviation of orthogonality between the H-AXIS and the V-AXIS;  as reported in the figure this angles cause a rotation of the system around the x-axis.</p></li><li><p><code>omegaVAXang</code>, <code>zVAXang</code>: </p><p>encode the deviation of the V-AXIS from the local vertical;   zVax is the angle between V-AXIS and the local vertical,   while omegaVAX is the azimuth of the ascending node (see the )</p></li><li><p><code>panang</code>, <code>tiltang</code>, <code>rollang</code>: </p><p>encode the camera orientation in the telescope reference frame: <em>pan</em> is a rotation around the x-axis,   <em>tilt</em> is a rotation around the y-axis, <em>roll</em> is a rotation around the z-axis. With this convention a   roll rotates the image seen by the camera around its center, a small pan (or tilt) shifts the image   along the camera X (or Y) axis.</p></li></ol><figure>
    <img src="assets/prm/fork.png" width="50%"/>
    <figcaption>Fig.2 Fork angle</figcaption>
</figure>
<figure>
    <img src="assets/prm/wobble.png" width="50%"/>
    <figcaption>Fig.3 Wobble angles</figcaption>
</figure><h2 id="Pointing-Reconstruction-Method"><a class="docs-heading-anchor" href="#Pointing-Reconstruction-Method">Pointing Reconstruction Method</a><a id="Pointing-Reconstruction-Method-1"></a><a class="docs-heading-anchor-permalink" href="#Pointing-Reconstruction-Method" title="Permalink"></a></h2><p>PRM consist of calculate a chain of rotations to project the direction of sight of a generic camera into the Topocentric Horizontal Reference Frame (the ground r.f. of the telescope  see <a href="../scanning/#Stripeline.telescopetoground"><code>telescopetoground</code></a>).</p><p>For clarity, we can split the rotations in three steps (<span>$R_i$</span> is a quaternion representing the rotation around the i axis):</p><p class="math-container">\[\mathbf{R}^{(\mathrm{tel})} = R_x(\mathrm{panang})R_y(\mathrm{tiltang})R_z(\mathrm{rollang})\]</p><p class="math-container">\[\mathbf{R}^{(\mathrm{V-AXIS})} = R_z(\mathrm{wheel3ang-wheel3ang_0})R_x(\mathrm{forkang})R_y(\mathrm{wheel2ang-wheel2ang_0})\]</p><p class="math-container">\[\mathbf{R}^{(\mathrm{geo})} = R_z(\mathrm{\omega_{VAX}})R_x(\mathrm{z_{VAX}})\]</p><p>Taking as a reference Fig.1: the first step project the coordinates from the camera reference frame to the telescope r.f., then the second one from the telescope r.f. to the V-AXIS r.f. and at the last one from the V-AXIS r.f to the ground r.f.; the final rotation operator describing the projection of the coordinate axis of the camera reference frame into the local  topocentric reference frame is: <span>$\mathbf{R}^{(\mathrm{geo})} * \mathbf{R}^{(\mathrm{V-AXIS})} * \mathbf{R}^{(\mathrm{tel})}$</span>.</p><p>This operator is the output of <a href="../scanning/#Stripeline.telescopetoground"><code>telescopetoground</code></a>.</p><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><p>Let&#39;s see a simple example, we&#39;ll now simulate the region of the sky observed by the telescope with and without the configuration angles (we will use very large values i.e. not a very realistic case). Just like for <a href="../scanning/#scanning_example">this example</a> let&#39;s load all the needed packages:</p><pre><code class="language-julia">using Plots
using Healpix
using Stripeline</code></pre><p>We can now define both the control angles (representing the motor position in function of time) and the configuration angles (representing the non idealities of the system):</p><pre><code class="language-julia">telescope_motors(time_s) = (0.0, deg2rad(20.0), timetorotang(time_s, 1))
config_ang = configuration_angles(
    forkang_rad = deg2rad(13.0),
    zVAXang_rad = deg2rad(10.0),
    omegaVAXang_rad = deg2rad(15.0)
)</code></pre><p>Now we can define a function that call genpointing with and without the non idealities and iterate over matrix containing the directions and set a specific value for each pixel in a Healpix map:</p><pre><code class="language-julia">function project_to_map(time_range, map, config_ang)
    # Call genpointings for the ideal case
    dirs, _ = genpointings(
        telescope_motors,
        Float64[0, 0, 1],
        time_range,
    )

    # Call genpointings for the non ideal case
    dirs_nonideal, _ = genpointings(
        telescope_motors,
        Float64[0, 0, 1],
        time_range,
        config_ang = config_ang
    )

    # For each sample, set the corresponding pixel in the sky map to:
    # 1 for the ideal case
    # 2 for the non ideal case
    for idx in 1:length(time_range)
        colat, long = dirs[idx, :]
        pixel_index = ang2pix(map, colat, long)
        map[pixel_index] = 1
        # Set the non ideal directions pixel
        colat, long = dirs_nonideal[idx, :]
        pixel_index = ang2pix(map, colat, long)
        map[pixel_index] = 2
    end
end</code></pre><p>Finally, we can create the map calling <code>project_to_map</code> and plotting the result:</p><pre><code class="language-julia">map = HealpixMap{Float64, RingOrder}(128)
sampling_time_s = 0.05
project_to_map(0.0:sampling_time_s:60.0, map, config_ang)
plot(map, orthographic)</code></pre><p><img src="../oneminutemap_prm.svg" alt/></p><p>Where the pixels set to 2 are the non ideal case taking into account of the configuration angles (in this example only the forkand and the wobble angles) while the pixels set to 1 are the ideal case alredy discussed <a href="../scanning/#scanning_example">here</a> </p><h2 id="Reference-Documentation"><a class="docs-heading-anchor" href="#Reference-Documentation">Reference Documentation</a><a id="Reference-Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#Reference-Documentation" title="Permalink"></a></h2><p>For a complete list of function used to reconstruct the scanning direction, see <a href="../scanning/#scanning_docs">this</a>.  </p><article class="docstring"><header><a class="docstring-binding" id="Stripeline.ConfigAngles" href="#Stripeline.ConfigAngles"><code>Stripeline.ConfigAngles</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">ConfigAngles</code></pre><p>Abstract type representing a set of configuration angles. Defining an abstract type is usefull because if you want to use differents angles or introduce new ones, you only have to define a new subtype and add a dedicated telescopetoground function dispatch.</p><p>See <a href="#Stripeline.configuration_angles"><code>configuration_angles</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/lspestrip/Stripeline.jl/blob/810d6202b188409d22572315c4940da17d080401/src/scanning.jl#L97-L106">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Stripeline.configuration_angles" href="#Stripeline.configuration_angles"><code>Stripeline.configuration_angles</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">configuration_angles(
    wheel1ang_0_rad :: Float64 = 0,
    wheel2ang_0_rad :: Float64 = 0,
    wheel3ang_0_rad :: Float64 = 0,
    forkang_rad :: Float64 = 0,
    omegaVAXang_rad :: Float64 = 0,
    zVAXang_rad :: Float64 = 0,
    panang_rad :: Float64 = 0,
    tiltang_rad :: Float64 = 0,
    rollang_rad :: Float64 = 0,   
)</code></pre><p>Struct containing the configuration angles for the telescope i.e. the angles describing the non idealities in the telescope (all of these parameters are considered equal to 0 in  an ideal telescope):</p><p>(<code>wheel1ang_0_rad</code>, <code>wheel2ang_0_rad</code>, <code>wheel3ang_0_rad</code>): these are the zero points angles for the three motors                                                            (respectively the boresight, the altitude and the ground                                                            motor)</p><p>(<code>forkang_rad</code>): describe the deviation of orthogonality between the H-AXIS and the V-AXIS</p><p>(<code>omegaVAXang_rad</code>, <code>zVAXang_rad</code>): wobble angles encoding the deviation of the V-AXIS from the local vertical;                                     zVAXang is the displacement from the V-AXIS,                                     omegaVAXang is the azimuth of the ascending node.</p><p>(<code>panang_rad</code>, <code>tiltang_rad</code>, <code>rollang_rad</code>): Tait-Brian angles encoding the camera orientation in the telescope reference frame.                                               Respectively around x,y and z axis.</p><p>See the documentation for a graphical rapresentation of each angles.</p><p>All of these angles must be expressed in RADIANS and measured anticlockwise.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/lspestrip/Stripeline.jl/blob/810d6202b188409d22572315c4940da17d080401/src/scanning.jl#L109-L142">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../noise/">« Noise generation</a><a class="docs-footer-nextpage" href="../acquisition/">Data acquisition »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.3 on <span class="colophon-date" title="Thursday 4 April 2024 18:06">Thursday 4 April 2024</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
