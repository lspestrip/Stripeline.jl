<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Map making · Stripeline.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Stripeline.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Introduction</a></li><li><a class="toctext" href="../basic/">Basic functions</a></li><li><a class="toctext" href="../instrumentdb/">Instrument database</a></li><li><a class="toctext" href="../scanning/">Scanning strategy</a></li><li><a class="toctext" href="../acquisition/">Data acquisition</a></li><li class="current"><a class="toctext" href>Map making</a><ul class="internal"></ul></li><li><a class="toctext" href="../simulation_tutorial/">Simulation tutorial</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Map making</a></li></ul><a class="edit-page" href="https://github.com/lspestrip/Stripeline.jl/blob/master/docs/src/mapmaking.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Map making</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Map-making-functions-1" href="#Map-making-functions-1">Map-making functions</a></h1><p>Stripeline implements a few functions to produce maps out of time-ordered data.</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Stripeline.tod2map_mpi" href="#Stripeline.tod2map_mpi"><code>Stripeline.tod2map_mpi</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">tod2map(pix_idx, tod, num_of_pixels, comm) -&gt; binned_map
tod2map(pix_idx, tod, num_of_pixels, data_properties, comm) -&gt; binned_map</code></pre><p>This function creates a binned map from the time-ordered data kept in the array <code>tod</code>, assuming that each sample is observing the pixel whose index is in <code>pix_idx</code>. The parameter <code>num_of_pixels</code> contains the number of pixels in the Healpix map, and it is used as an upper bound for the values in <code>pix_idx</code>. The parameter <code>comm</code> must be a MPI communicator, or <code>missing</code> if you are not using MPI. This is a MPI based function: each MPI process computes a map from its available data.  All partial maps are then combined together with MPI.allreduce. The function returns an array containing the binned map.</p><p>If Array of structures <code>data_properties_struct</code>is passed to the function, the output binned map will be a weighted binned map. Each sample will be weighted according to the inverse white noise variance σ^2 of the corrisponding polarimeter. In this way, the less noisy polarimeters will count more in the estimation of the map.</p><p><strong>Requirements</strong></p><ul><li>The length of the arrays <code>pix_idx</code> and <code>tod</code> must be the same</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/lspestrip/Stripeline.jl/blob/fa6fe2c0eba7e94c5b5dae76c21497c8c0e86c24/src/mapmaker.jl#L63-L84">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Stripeline.baseline2map_mpi" href="#Stripeline.baseline2map_mpi"><code>Stripeline.baseline2map_mpi</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">baseline2map_mpi(pix_idx, baselines, baseline_lengths, num_of_pixels, comm)-&gt; noise_map
baseline2map_mpi(pix_idx, baselines, num_of_pixels, data_properties, comm) -&gt; noise_map</code></pre><p>This is a MPI based function: each MPI process computes a map from its available data.  All partial maps are then combined together with MPI.allreduce. The function returns an array containing the binned map.</p><p>If Array of structures <code>data_properties_struct</code>is passed to the function (instead of <code>baseline_lengths</code>) the output binned map will be a weighted binned map. Each sample will be weighted according to the inverse white noise variance σ^2 of the corrisponding polarimeter. In this way, the less noisy polarimeters will count more in the estimation of the map.</p><p><strong>Requirements</strong></p><ul><li>The length of <code>baselines</code> and <code>baseline_lengths</code> must be the same;</li><li>The value <code>sum(baseline_lengths)</code> must be the same as the length of <code>pix_idx</code>.</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/lspestrip/Stripeline.jl/blob/fa6fe2c0eba7e94c5b5dae76c21497c8c0e86c24/src/mapmaker.jl#L159-L175">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Stripeline.destripe" href="#Stripeline.destripe"><code>Stripeline.destripe</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">destripe(pix_idx, tod, num_of_pixels, data_properties, rank, comm; threshold = 1e-9, max_iter = 10000) -&gt; (pixels, baselines)</code></pre><p>This MPI based function creates a map from a TOD and removes both 1/f and white noise, using the destriping technique.</p><p>The parameters passed to the function have the following meaning:</p><ul><li><p><code>pix_idx</code>: array containing the indices of the pixels visited by the instrument</p></li><li><p><code>tod</code>: the values measured by the polarimeters for each pixel (either I, Q, or U)</p></li><li><p><code>num_of_pixels</code>: the number of pixels in the map to be  produced. This is used as an upper limit for the values in <code>pix_idx</code></p></li><li><p><code>data_properties</code>: an array of structures <code>data_properties_struct</code>,   holding information on each simulated polarimeter noise level,   number and length of 1/f baselines and total number of samples.  It can be obtained by using function <code>get_data_properties</code>.</p></li><li><p><code>rank</code>: the rank of the current MPI process</p></li><li><p><code>comm</code>: the MPI communicator object.</p></li></ul><p>The following arguments are optional:</p><ul><li><p><code>threshold</code> is used by the conjugated-gradient algorithm. When the  residual error of the iteration goes below this value, the iteration  stops. The smaller the value, the more accurate the solution.</p></li><li><p><code>max_iter</code> is the maximum number of iterations to be executed in the  conjugated-gradient algorithm. If the algorithm does not converge  within this number of iterations, the process will quit without  having reached the convergence threshold (see the <code>threshold</code>  keyword above).</p></li></ul><p>The function returns a 2-tuple containing the destriped map itself (<code>Array{T,1}</code>, where <code>T</code> is the base type used for the TOD in the argument<code>tod</code>) and an array containing the baselines. Since it is not granted that the sequence of convergence parameters of the conjugate gradient is monotonically decreasing, the code keeps the lowest value of them and the corresponding array of baselines.  If the loop ends because the maximum number of iterations has been reached, this is the configuration that will be returned to the caller.</p><p><strong>Remarks</strong></p><ul><li>The length of the arrays <code>pix_idx</code> and <code>tod</code> must be the same;</li><li>If you are not using MPI, pass <code>missing</code> to the <code>comm</code> parameter.</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/lspestrip/Stripeline.jl/blob/fa6fe2c0eba7e94c5b5dae76c21497c8c0e86c24/src/mapmaker.jl#L442-L491">source</a></section><footer><hr/><a class="previous" href="../acquisition/"><span class="direction">Previous</span><span class="title">Data acquisition</span></a><a class="next" href="../simulation_tutorial/"><span class="direction">Next</span><span class="title">Simulation tutorial</span></a></footer></article></body></html>
