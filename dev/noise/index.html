<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Noise generation · Stripeline.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Stripeline.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><a class="tocitem" href="../basic/">Basic functions</a></li><li><a class="tocitem" href="../instrumentdb/">Instrument database</a></li><li><a class="tocitem" href="../tod/">Time-ordered data</a></li><li><a class="tocitem" href="../scanning/">Scanning strategy</a></li><li class="is-active"><a class="tocitem" href>Noise generation</a><ul class="internal"><li><a class="tocitem" href="#Generating-white-noise"><span>Generating white noise</span></a></li></ul></li><li><a class="tocitem" href="../prm/">Pointing Reconstruction Model</a></li><li><a class="tocitem" href="../acquisition/">Data acquisition</a></li><li><a class="tocitem" href="../mapmaking/">Map making</a></li><li><a class="tocitem" href="../simulation_tutorial/">Full-scale simulation tutorial</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Noise generation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Noise generation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/lspestrip/Stripeline.jl/blob/master/docs/src/noise.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Generating-realistic-noise"><a class="docs-heading-anchor" href="#Generating-realistic-noise">Generating realistic noise</a><a id="Generating-realistic-noise-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-realistic-noise" title="Permalink"></a></h1><p>Any detector introduces noise in its measurements, and this is often one of the limiting factors in achieving the goal accuracy for an experiment. Microwave receivers are no exception to this rule, and thus Stripeline provides tools to inject pseudo-random noise in the TODs.</p><p>The noise that we observe in detectors is usually made of several components:</p><ul><li>Intrinsic noise produced mostly from the amplifiers; this noise is usually the superposition of classic Gaussian noise and correlated noise, usually called <span>$1/f$</span> noise.</li><li>White noise caused by any thermal load between the sky (e.g., the atmosphere) and the detector.</li><li>Noise produced by other receivers and entering another because of poor insulation across the focal plane and the electronic boards.</li></ul><p>Stripeline provides a set of tools that are able to inject realistic noise into the TODs; these functions are aware of the observed correlations between receivers and can simulate them.</p><h2 id="Generating-white-noise"><a class="docs-heading-anchor" href="#Generating-white-noise">Generating white noise</a><a id="Generating-white-noise-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-white-noise" title="Permalink"></a></h2><p>This section assumes that you read and understood Ch. <a href="../tod/#Time-ordered-data-(TOD)">Time-ordered data (TOD)</a>, which explains how timelines are allocated and stored in memory.</p><p>The function <a href="#Stripeline.fillnoise!"><code>fillnoise!</code></a> takes a TOD and substitutes each sample with a pseudo-random number following a given statistics. This function can insert correlations between different channels (Q1, Q2, U1, U2) by means of 4×4 covariance matrices that are passed through the first parameter. This function supports MPI natively, which means that you can call it in a MPI script and will generate uncorrelated noise across the MPI processes.</p><p>Typically, you will get these matrices from the instrument database (see Ch. <a href="../instrumentdb/#The-Strip-Instrument-Database">The Strip Instrument Database</a>). Let&#39;s create an empty TOD:</p><pre><code class="language-julia-repl">
julia&gt; tod = allocate_tod(StripTod, Float32, 0:0.1:100, [&quot;I3&quot;])  # Simulate receiver I3
TOD(1 polarimeters, 1001 rows/polarimeter, time range from 0.0 to 100.0)

julia&gt; db = InstrumentDB()
InstrumentDB(55 horns, 66 detectors)

julia&gt; fillnoise!(tod) do polname
           s = spectrum(db, polname)
           # We must return the covariance matrices of the PWR and DEM signals, respectively
           (s.pwr_cov_matrix_k2, s.dem_cov_matrix_k2)
       end

julia&gt; # Show the noise time stream for Q1 and Q2
       plot(
           tod.time_range,
           demq1(tod, 1),
           xlabel = &quot;Time [s]&quot;,
           ylabel = &quot;Output [K]&quot;,
           label = &quot;DEM Q1&quot;,
       );

julia&gt; plot!(tod.time_range, demq2(tod, 1), label = &quot;DEM Q2&quot;);</code></pre><p><img src="../white-noise-tod.svg" alt/></p><div class="admonition is-warning"><header class="admonition-header">Deprecated functions</header><div class="admonition-body"><p>There is an old function, <code>generate_noise_mpi</code>, which can produce <span>$1/f$</span> noise, but it&#39;s being deprecated because it&#39;s slow and does not permit to mix noise across channels.</p></div></div><article class="docstring"><header><a class="docstring-binding" id="Stripeline.fillnoise!" href="#Stripeline.fillnoise!"><code>Stripeline.fillnoise!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">fillnoise!(covfn_k2, tod::StripTod)</code></pre><p>Overwrite all the samples in the TOD with white noise so that the covariance matrix of the PWR and DEM signals for each polarimeter is determined by the result of a call to <code>covfn_k2</code> like the following:</p><pre><code class="nohighlight">(pwr_cov, dem_cov) = covfn_k2(polarimeter)</code></pre><p>where <code>polarimeter</code> is one of the values in <code>tod.polarimeters</code>. The two variables <code>pwr_cov</code> and <code>dem_cov</code> must be 4×4 covariance matrices that express the covariance in K² (<strong>not</strong> in ADU!).</p><p>A typical call to <code>fillnoise!</code> will use the instrument database to retrieve the covariance matrices; for instance:</p><pre><code class="nohighlight">db = Sl.InstrumentDB()
tod = Sl.allocate_tod(Float32, 0.0:0.1:10000.0, [&quot;I3&quot;])
Tmp.fillnoise!(tod) do polname
    spec = Sl.spectrum(db, polname)
    (spec.pwr_cov_matrix_k2, spec.dem_cov_matrix_k2)
end</code></pre><p>No 1/f noise is simulated in this function.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/lspestrip/Stripeline.jl/blob/fe24f882e55903ae9147d4113c8d6c2c61fc3c25/src/tod.jl#L315-L341">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../scanning/">« Scanning strategy</a><a class="docs-footer-nextpage" href="../prm/">Pointing Reconstruction Model »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.3 on <span class="colophon-date" title="Tuesday 12 March 2024 10:53">Tuesday 12 March 2024</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
